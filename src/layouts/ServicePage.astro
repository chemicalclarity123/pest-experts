---
import { 
  generateEnhancedServiceSchema, 
  generateEnhancedLocalBusinessSchema,
  generateFAQSchema 
} from '../lib/schema';
import Seo from '../components/Seo.astro';

interface Props {
  // Service data
  serviceName: string;
  serviceDescription: string;
  serviceType?: string;
  
  // SEO metadata
  metaTitle?: string;
  metaDescription?: string;
  shareImage?: string;
  
  // Local SEO data
  areaServed?: string[];
  knowsAbout?: string[];
  faqs?: Array<{
    question: string;
    answer: string;
  }>;
  
  // Company settings (passed from page)
  companySettings?: any;
}

const {
  serviceName,
  serviceDescription,
  serviceType,
  metaTitle,
  metaDescription,
  shareImage,
  areaServed,
  knowsAbout,
  faqs,
  companySettings,
} = Astro.props;

const title = metaTitle || `${serviceName} | ${companySettings?.businessName || 'Pest Experts'}`;
const description = metaDescription || serviceDescription;

// Generate Schemas for compatibility
const serviceSchema = generateEnhancedServiceSchema({
  name: serviceName,
  description: serviceDescription,
  serviceType: serviceType || 'PestControl',
  provider: {
    name: companySettings?.businessName || 'Pest Experts',
    url: Astro.site?.toString() || 'https://pest-experts-site.pages.dev',
  },
  areaServed,
  knowsAbout,
  aggregateRating: companySettings?.aggregateRating,
});

let businessSchema;
if (companySettings) {
  businessSchema = generateEnhancedLocalBusinessSchema({
    name: companySettings.businessName,
    description: serviceDescription,
    url: Astro.site?.toString() || 'https://pest-experts-site.pages.dev',
    telephone: companySettings.contactInfo?.telephone,
    email: companySettings.contactInfo?.email,
    address: companySettings.address,
    geo: companySettings.geo,
    openingHours: companySettings.businessHours?.map((h: any) => `${h.days} ${h.opens}-${h.closes}`),
    priceRange: companySettings.priceRange,
    aggregateRating: companySettings.aggregateRating,
    sameAs: companySettings.sameAs?.map((s: any) => s.url),
    areaServed,
    logo: companySettings.logo,
  });
}

const faqSchema = faqs && faqs.length > 0 ? generateFAQSchema({ faqs }) : null;

const schemaMarkup = [
  serviceSchema,
  ...(businessSchema ? [businessSchema] : []),
  ...(faqSchema ? [faqSchema] : [])
];

const seo = {
  metaTitle: title,
  metaDescription: description,
  shareImage,
};
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    <Seo
      seo={seo}
      schemaMarkup={schemaMarkup}
    />
  </head>
  <body>
    <main>
      <slot />
    </main>
  </body>
</html>

<style is:global>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    line-height: 1.6;
    color: #333;
  }

  main {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }
</style>
