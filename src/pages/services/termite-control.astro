---
import ServicePage from '../../layouts/ServicePage.astro';
import { fetchServiceBySlug, fetchCompanySettings } from '../../lib/sanity-client';

// Fetch company settings
const companySettings = await fetchCompanySettings();

// Try to fetch service from Sanity
const sanityService = await fetchServiceBySlug('termite-control');

// Fallback data with full Local SEO structure
const fallbackData = {
  title: 'Termite Control',
  slug: 'termite-control',
  description: 'Professional termite inspection and treatment services',
  seo: {
    metaTitle: 'Expert Termite Control Services | Pest Experts',
    metaDesc: 'Professional termite inspection, treatment & prevention. Serving the Greater Metro Area. 4.8‚òÖ rated. Call for free inspection!',
  },
  localContext: {
    serviceType: 'Termite Control Service',
    pests: [
      'Subterranean Termites',
      'Drywood Termites',
      'Dampwood Termites',
      'Formosan Termites',
    ],
    areas: [
      'Downtown',
      'Midtown',
      'Uptown',
      'East Side',
      'West End',
      'Suburbs',
    ],
    faqs: [
      {
        question: 'How do I know if I have termites?',
        answer: 'Common signs include hollow-sounding wood, discarded wings near windows, mud tubes on exterior walls, and visible damage to wood structures. Our professional inspection can detect termites even before visible damage appears.',
      },
      {
        question: 'How long does termite treatment take?',
        answer: 'Most termite treatments can be completed in 1-2 days, depending on the size of your property and severity of infestation. We use advanced treatment methods that provide long-lasting protection.',
      },
      {
        question: 'Do you offer warranties on termite treatment?',
        answer: 'Yes! We provide comprehensive warranties on all termite treatments. Our team will discuss warranty options during your free inspection.',
      },
      {
        question: 'What areas do you serve?',
        answer: 'We serve the entire Greater Metropolitan Area including Downtown, Midtown, Uptown, East Side, West End, and surrounding suburbs.',
      },
    ],
  },
};

// Use Sanity data if available, otherwise fallback
const service = sanityService || fallbackData;
const dataSource = sanityService ? 'Sanity CMS' : 'Static Data';
---

<ServicePage
  serviceName={service.title}
  serviceDescription={service.description}
  serviceType={service.localContext?.serviceType}
  metaTitle={service.seo?.metaTitle}
  metaDescription={service.seo?.metaDesc}
  shareImage={service.seo?.shareImage}
  areaServed={service.localContext?.areas}
  knowsAbout={service.localContext?.pests}
  faqs={service.localContext?.faqs}
  companySettings={companySettings}
>
  <article>
    <header>
      <div class="badge-container">
        {companySettings?.aggregateRating && (
          <div class="rating-badge">
            ‚≠ê {companySettings.aggregateRating.ratingValue} 
            <span class="review-count">
              ({companySettings.aggregateRating.reviewCount} reviews)
            </span>
          </div>
        )}
        <div class="data-badge">Data: {dataSource}</div>
      </div>
      
      <h1>{service.title}</h1>
      <p class="lead">{service.description}</p>
    </header>

    <section class="service-details">
      <h2>Expert Termite Solutions</h2>
      <p>
        Protect your property from costly termite damage with our professional inspection
        and treatment services. We use advanced detection technology and proven treatment
        methods to eliminate termites and prevent future infestations.
      </p>

      {service.localContext?.pests && service.localContext.pests.length > 0 && (
        <div class="expertise-section">
          <h3>Our Termite Expertise</h3>
          <div class="pest-tags">
            {service.localContext.pests.map((pest: string) => (
              <span class="pest-tag">{pest}</span>
            ))}
          </div>
        </div>
      )}

      <h3>Our Process</h3>
      <ol class="process-list">
        <li><strong>Free Inspection:</strong> Comprehensive property assessment</li>
        <li><strong>Detection:</strong> Advanced thermal imaging and moisture detection</li>
        <li><strong>Treatment Plan:</strong> Customized solution for your property</li>
        <li><strong>Elimination:</strong> Professional treatment application</li>
        <li><strong>Prevention:</strong> Ongoing monitoring and protection</li>
      </ol>

      {service.localContext?.areas && service.localContext.areas.length > 0 && (
        <div class="service-areas">
          <h3>Service Areas</h3>
          <p>We proudly serve:</p>
          <div class="area-tags">
            {service.localContext.areas.map((area: string) => (
              <span class="area-tag">üìç {area}</span>
            ))}
          </div>
        </div>
      )}

      {service.localContext?.faqs && service.localContext.faqs.length > 0 && (
        <div class="faq-section">
          <h2>Frequently Asked Questions</h2>
          {service.localContext.faqs.map((faq: any) => (
            <details class="faq-item">
              <summary>{faq.question}</summary>
              <p>{faq.answer}</p>
            </details>
          ))}
        </div>
      )}

      {companySettings && (
        <div class="contact-section">
          <h3>Contact Us</h3>
          <div class="contact-grid">
            {companySettings.contactInfo?.telephone && (
              <div class="contact-item">
                <strong>üìû Phone:</strong>
                <a href={`tel:${companySettings.contactInfo.telephone}`}>
                  {companySettings.contactInfo.telephone}
                </a>
              </div>
            )}
            {companySettings.contactInfo?.email && (
              <div class="contact-item">
                <strong>‚úâÔ∏è Email:</strong>
                <a href={`mailto:${companySettings.contactInfo.email}`}>
                  {companySettings.contactInfo.email}
                </a>
              </div>
            )}
          </div>
          
          {companySettings.businessHours && companySettings.businessHours.length > 0 && (
            <div class="hours">
              <strong>Business Hours:</strong>
              <ul>
                {companySettings.businessHours.map((hours: any) => (
                  <li>{hours.days}: {hours.opens} - {hours.closes}</li>
                ))}
              </ul>
            </div>
          )}
        </div>
      )}

      <div class="cta-section">
        <a href="/" class="back-link">‚Üê Back to Home</a>
      </div>
    </section>
  </article>
</ServicePage>

<style>
  article {
    background: #fff;
    border-radius: 8px;
    padding: 2rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  header {
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #e5e7eb;
  }

  .badge-container {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }

  .rating-badge {
    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.875rem;
  }

  .review-count {
    opacity: 0.9;
    font-weight: 400;
  }

  .data-badge {
    background: #e0e7ff;
    color: #4338ca;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
  }

  h1 {
    font-size: 2.5rem;
    color: #1f2937;
    margin-bottom: 0.5rem;
  }

  .lead {
    font-size: 1.25rem;
    color: #6b7280;
  }

  .service-details {
    margin-top: 2rem;
  }

  h2 {
    font-size: 2rem;
    color: #1f2937;
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  h3 {
    font-size: 1.5rem;
    color: #374151;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }

  p {
    margin-bottom: 1rem;
    color: #4b5563;
  }

  .expertise-section {
    background: #f0fdf4;
    border-left: 4px solid #10b981;
    padding: 1.5rem;
    margin: 2rem 0;
    border-radius: 4px;
  }

  .pest-tags,
  .area-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
  }

  .pest-tag {
    background: #10b981;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .area-tag {
    background: #667eea;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .process-list {
    list-style: none;
    counter-reset: step-counter;
    padding-left: 0;
  }

  .process-list li {
    counter-increment: step-counter;
    padding: 1rem;
    margin-bottom: 0.5rem;
    background: #f9fafb;
    border-radius: 6px;
    position: relative;
    padding-left: 3rem;
  }

  .process-list li::before {
    content: counter(step-counter);
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: #667eea;
    color: white;
    width: 1.5rem;
    height: 1.5rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.875rem;
  }

  .service-areas {
    background: #eff6ff;
    border-left: 4px solid #667eea;
    padding: 1.5rem;
    margin: 2rem 0;
    border-radius: 4px;
  }

  .faq-section {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 2px solid #e5e7eb;
  }

  .faq-item {
    background: #f9fafb;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    cursor: pointer;
    transition: background 0.2s;
  }

  .faq-item:hover {
    background: #f3f4f6;
  }

  .faq-item summary {
    font-weight: 600;
    color: #1f2937;
    font-size: 1.125rem;
    list-style: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .faq-item summary::after {
    content: '+';
    font-size: 1.5rem;
    color: #667eea;
    transition: transform 0.2s;
  }

  .faq-item[open] summary::after {
    transform: rotate(45deg);
  }

  .faq-item p {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #e5e7eb;
  }

  .contact-section {
    background: #f9fafb;
    padding: 2rem;
    border-radius: 8px;
    margin: 2rem 0;
  }

  .contact-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
  }

  .contact-item {
    padding: 1rem;
    background: white;
    border-radius: 6px;
  }

  .contact-item strong {
    display: block;
    margin-bottom: 0.5rem;
    color: #1f2937;
  }

  .contact-item a {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
  }

  .contact-item a:hover {
    text-decoration: underline;
  }

  .hours {
    margin-top: 1.5rem;
  }

  .hours ul {
    list-style: none;
    padding-left: 0;
    margin-top: 0.5rem;
  }

  .hours li {
    padding: 0.25rem 0;
    color: #4b5563;
  }

  .cta-section {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 2px solid #e5e7eb;
  }

  .back-link {
    display: inline-block;
    color: #667eea;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border: 2px solid #667eea;
    border-radius: 8px;
    transition: all 0.2s;
    text-decoration: none;
  }

  .back-link:hover {
    background: #667eea;
    color: white;
  }

  @media (max-width: 768px) {
    h1 {
      font-size: 2rem;
    }

    h2 {
      font-size: 1.5rem;
    }

    .contact-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
